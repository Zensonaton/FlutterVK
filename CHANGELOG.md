<!-- markdownlint-disable MD033 -->

# Flutter VK vTODO

**Важное предупреждение**: это **бета-обновление**, содержащее в себе немало технических изменений. Сейчас приложение находится в частично "поломанном" состоянии. Обновляйтесь только в том случае, если и вправду понимаете, что делаете. Вам, вероятнее всего, придётся откатиться до [предыдущей версии Flutter VK](https://github.com/Zensonaton/FlutterVK/releases) если Вы хотите стабильной работы приложения. **Сейчас очень много всего в приложении поломано**, и я это знаю. К примеру, такие вещи, как открытие плейлистов, кэширование, получение текстов песен и прочего целиком и полностью поломано.

Это обновление привносит в себя огромное техническое изменение: Переход от одной библиотеки для state-менеджмента, [`provider`](https://pub.dev/packages/provider) к другой, [`riverpod`](https://pub.dev/packages/riverpod) и [`flutter_hooks`](https://pub.dev/packages/flutter_hooks), а так же библиотека [`go_router`](https://pub.dev/packages/go_router) для реализации навигации между страницами.

К сожалению, эти технические изменения почти что не видны обычному пользователю, однако они были нужны ради стабильной работы приложения, а так же различных оптимизаций. Однако, несмотря на это, обновление привнесло некоторые изменения интерфейса и прочих функций.

## Фиксы

- Фикс появления надписи "Подключить рекомендации ВКонтакте" когда они подключены.
- Фикс возобновления паузы из-за функции "пауза при минимальной громкости".
- Фикс повторного создания `stopOnPause`-таймера.
- Фикс сильно выделяющейся иконки Explicit.
- Фикс отображения переключения shuffle в мини-плеере.
- Фикс загрузки текстов песен с ВКонтакте.
- Фикс неизменяющегося мини-плеера при изменении треков.
- Фикс возможности скроллить текст skeleton loader текста песни в Desktop Layout'е при полноэкранном плеере, а так же эффект fade'а для него.
- Фикс работы `FadingListView`.

<!-- Изменения с других Pre-release версий, которые должны быть отображены в non-pre версии:

## Изменения

- Отображение недоступных треков.
- Вместо ID пользователя отображается его `@username` в профиле.
- Перепись экрана профиля с целью уменьшения количества повторения кода.
- Изменение вида настроек на экране профиля.
- Иконка открытия диалога возле кнопок на экране профиля.
- Изменение названий и описаний у многих настроек для упрощения читабельности.
- Настройка "OLED-тема" теперь отключается, если включена светлая тема.
- Настройка "debug-логирование плеера" теперь отображено лишь на desktop-платформах.
- Пересмотр значений по-умолчанию у настроек.
- Избавление от функционала загрузки треков из Spotify ввиду ограничений со стороны сервера без premium-подписки.
- Возвращение функции "экспорт списка треков".
- Логирование ошибок Provider'ов.
- Новая настройка: "Тип палитры цветов обложки".
- Новое сообщение для README-файла, располагаемый в папке с кэшированными треками.
- Более правильный цвет у "свечения" обложек треков в мини и полноэкранном плееров.
- Своя реализация для получения цветов обложки трека, использующая Isolate где это возможно.
- Избавление от `WelcomeDialog` при авторизации.
- Избавление от `PhotoMaxOrig` ввиду ненадобности.
- Изменение текста для диалога "подключение рекомендаций".
- Избавление от диалога, спрашивающего разрешение на отправку статистики о прослушивании треков.
- Игнорирование ошибки "какой сейчас вайб не был найден".
- Управление плеером теперь использует toggle'ы вместо `!state`.
- Уменьшение количества вызовов `setState` от плеера.
- Удаление настройки "Точный алгоритм цветов плеера".
- Проверка на соответствие ID пользователей ВК при вторичной авторизации.
- Некоторые из кнопок (лайк, дизлайк) вместо полноэкранной анимации загрузки теперь отображают загрузку в самой кнопке.
- Настройка для debug-логирования плеера.
- Длительность треков теперь не отображается в разделе "Совпадения по вкусам".
- Lottie-анимация у VK Mix теперь отображается лишь во время воспроизведения.
- Адекватный Skeleton-loader для VK Mix.
- Система для логирования крашей и других проблем приложения.
- Долгое нажатие на кнопку "паузы" в мини-плеере снизу теперь его насильно останавливает.
- Изменение текста для `WelcomeRoute`.
- Избавление от анимации появления изображения трека.
- Использование `/welcome` как go_route вместо `/`.
- Оптимизации.

## Фиксы

- Фикс цветов приложения.
- Фикс OLED-темы.
- Фикс иконки настройки "канал обновлений".
- Фикс появления кнопки "В реальном времени" если не подключены рекомендации ВК.
- Фикс выхода из аккаунта, если нету папки с треками.
- Фикс появления плейлистов из раздела "в реальном времени" в виде Skeleton-loader'ов.
- Фикс входа в приложение ввиду SSL-сертификатов.
- Фикс различных багов интерфейса, связанных с закрытием плеера.
- Фикс запуска приложения.
- Фикс авторизации.
- Фикс цветов "сердечек" у `AudioTrackTile`.
- Фикс иконки у раздела "музыка".
- Фикс цветов для диалога "тип палитры цветов обложки".
- Фикс иконки для диалога "Канал обновлений".
- Фикс запуска неправильного трека.
- Фикс overflow'а на экране с музыкой.
- Фикс отсутствия анимации паузы при полноэкранном мобильном плеере.
- Фикс не переключающегося активного трека на экране плейлиста.

-->
